<?xml version="1.0" encoding="UTF-8"?>
<ViewConfig>
  <Arguments/>
  <Context/>
  <Model>
    <DataType name="dataTypeUser">
      <Property name="creationType">com.bstek.bdf2.core.model.DefaultUser</Property>
      <PropertyDef name="password">
        <Property name="dataType">String</Property>
        <Property name="label">密码</Property>
        <Property name="required">true</Property>
        <Validator type="length">
          <Property name="minLength">8</Property>
        </Validator>
        <Validator type="custom">
          <ClientEvent name="onValidate">var confirm = arg.data;&#xD;
//var password = arg.entity.get(&quot;password&quot;);&#xD;
if (valijs(confirm)) {&#xD;
	arg.result = { state:&quot;ok&quot;}&#xD;
} else {&#xD;
	arg.result = { state:&quot;error&quot;, text: &quot;密码强度不符合,请重新输入(密码至少有一位字母和一位特殊字符，如@c12345678)&quot;};	&#xD;
}&#xD;
&#xD;
function valijs(now){&#xD;
	&#xD;
    var re = new RegExp(&quot;[a-zA-Z]&quot;);&#xD;
    var len = re.test(now);&#xD;
	re = new RegExp(&quot;((?=[\x21-\x7e]+)[^A-Za-z0-9])&quot;);&#xD;
    len1 = re.test(now);&#xD;
    re = new RegExp(&quot;[0-9]&quot;);&#xD;
    len2 = re.test(now);&#xD;
    if(len&amp;&amp;len1&amp;&amp;len2){&#xD;
        return true;&#xD;
    }&#xD;
    else return false;&#xD;
}&#xD;
</ClientEvent>
        </Validator>
      </PropertyDef>
      <PropertyDef name="confirmPassword">
        <Property name="dataType">String</Property>
        <Property name="label">确认密码</Property>
        <Property name="required">true</Property>
        <Validator type="custom">
          <ClientEvent name="onValidate">var confirm = arg.data;&#xD;
var password = arg.entity.get(&quot;password&quot;);&#xD;
if (confirm ==password) {&#xD;
	arg.result = { state:&quot;ok&quot;}&#xD;
} else {&#xD;
	arg.result = { state:&quot;error&quot;, text: &quot;两次密码不一致&quot;};	&#xD;
}</ClientEvent>
        </Validator>
      </PropertyDef>
      <PropertyDef name="salt">
        <Property name="dataType">String</Property>
      </PropertyDef>
      <PropertyDef name="male">
        <Property name="dataType">boolean</Property>
        <Property name="label">性别</Property>
        <Property name="mapping">
          <Property name="mapValues">
            <Collection>
              <Entity>
                <Property name="key">true</Property>
                <Property name="value">男</Property>
              </Entity>
              <Entity>
                <Property name="key">false</Property>
                <Property name="value">女</Property>
              </Entity>
            </Collection>
          </Property>
        </Property>
        <Property name="defaultValue">true</Property>
      </PropertyDef>
      <PropertyDef name="enabled">
        <Property name="dataType">boolean</Property>
        <Property name="label">是否可用</Property>
        <Property name="defaultValue">true</Property>
      </PropertyDef>
      <PropertyDef name="birthday">
        <Property name="dataType">Date</Property>
        <Property name="label">出生日期</Property>
      </PropertyDef>
      <PropertyDef name="username">
        <Property name="dataType">String</Property>
        <Property name="label">用户名</Property>
        <Property name="required">true</Property>
        <Validator type="ajax">
          <Property name="service">bdf2.userMaintain#userIsExists</Property>
        </Validator>
        <Validator type="length">
          <Property name="maxLength">60</Property>
          <Property name="minLength">2</Property>
        </Validator>
      </PropertyDef>
      <PropertyDef name="cname">
        <Property name="dataType">String</Property>
        <Property name="label">姓名</Property>
        <Property name="required">true</Property>
        <Validator type="length">
          <Property name="minLength">2</Property>
          <Property name="maxLength">60</Property>
        </Validator>
      </PropertyDef>
      <PropertyDef name="administrator">
        <Property name="dataType">boolean</Property>
        <Property name="label">是否为管理员</Property>
      </PropertyDef>
      <PropertyDef name="companyId">
        <Property name="dataType">String</Property>
      </PropertyDef>
      <Reference name="positions">
        <Property name="dataType">[$dataTypePosition]</Property>
        <Property name="dataProvider">bdf2.positionMaintain#loadPositionByUsername</Property>
        <Property name="parameter">$${this.username}</Property>
        <Property name="label">岗位</Property>
      </Reference>
      <Reference name="depts">
        <Property name="dataType">[$dataTypeDept]</Property>
        <Property name="parameter">$${this.username}</Property>
        <Property name="label">部门</Property>
        <Property name="dataProvider">bdf2.userMaintain#loadUserDepts</Property>
      </Reference>
      <PropertyDef name="leagueMember">
        <Property name="dataType">boolean</Property>
        <Property name="label">是否团员</Property>
      </PropertyDef>
      <PropertyDef name="partyMember">
        <Property name="dataType">boolean</Property>
        <Property name="label">是否党员</Property>
      </PropertyDef>
      <PropertyDef name="technicalLevel">
        <Property name="dataType">String</Property>
        <Property name="label">职称</Property>
      </PropertyDef>
      <PropertyDef name="ip">
        <Property name="dataType">String</Property>
        <Property name="label">绑定IP</Property>
        <Validator type="regExp">
          <Property name="resultMessage">IP地址格式输入错误</Property>
          <Property name="whiteRegExp">^((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)\.){3}(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)$</Property>
          <Property name="validateMode">whiteBlack</Property>
        </Validator>
      </PropertyDef>
      <PropertyDef name="miji">
        <Property name="dataType">String</Property>
        <Property name="label">密级</Property>
        <Property name="mapping">
          <Property name="mapValues">
            <Collection>
              <Entity>
                <Property name="key">5</Property>
                <Property name="value">机密</Property>
              </Entity>
              <Entity>
                <Property name="key">4</Property>
                <Property name="value">秘密</Property>
              </Entity>
              <Entity>
                <Property name="key">3</Property>
                <Property name="value">核心商密</Property>
              </Entity>
              <Entity>
                <Property name="key">2</Property>
                <Property name="value">普通商密</Property>
              </Entity>
              <Entity>
                <Property name="key">1</Property>
                <Property name="value">内部</Property>
              </Entity>
              <Entity>
                <Property name="key">0</Property>
                <Property name="value">公开</Property>
              </Entity>
            </Collection>
          </Property>
        </Property>
        <Property name="defaultValue">1</Property>
        <Validator type="custom">
          <ClientEvent name="onValidate">var secret = ${loginUser.getMiji()};&#xD;
if (arg.data &lt;= secret) {&#xD;
	arg.result = { state:&quot;ok&quot;};&#xD;
} &#xD;
else {&#xD;
	arg.result = { state:&quot;error&quot;, text: &quot;新增数据的密级超过自己对应密级&quot;};	&#xD;
}</ClientEvent>
        </Validator>
      </PropertyDef>
      <PropertyDef name="loginCount">
        <Property name="dataType">int</Property>
        <Property name="label">登录计数</Property>
        <Property name="defaultValue">0</Property>
      </PropertyDef>
      <PropertyDef name="lock">
        <Property name="dataType">boolean</Property>
        <Property name="label">账户锁定</Property>
        <Property name="defaultValue">false</Property>
      </PropertyDef>
    </DataType>
    <DataType name="dataTypeResetPassword">
      <PropertyDef name="oldPassword">
        <Property name="dataType">String</Property>
        <Property name="label">原始密码</Property>
        <Property name="required">true</Property>
        <Validator type="ajax">
          <ClientEvent name="beforeExecute">var user=view.id(&quot;dataSetUser&quot;).getData(&quot;#&quot;)&#xD;
var username=user.get(&quot;username&quot;);&#xD;
var para={&#xD;
	&quot;username&quot;:username,&#xD;
	&quot;inputOldPassword&quot;:arg.data&#xD;
};&#xD;
arg.parameter=para;&#xD;
&#xD;
</ClientEvent>
          <Property name="service">bdf2.userMaintain#oldPasswordIsRight</Property>
        </Validator>
        <Validator type="length">
          <Property name="minLength">4</Property>
        </Validator>
      </PropertyDef>
      <PropertyDef name="newPassword">
        <Property name="dataType">String</Property>
        <Property name="label">新密码</Property>
        <Property name="required">true</Property>
        <Validator type="length">
          <Property name="minLength">8</Property>
        </Validator>
        <Validator type="custom">
          <ClientEvent name="onValidate">var confirm = arg.data;&#xD;
//var password = arg.entity.get(&quot;password&quot;);&#xD;
alert(confirm);&#xD;
alert(valijs(confirm));&#xD;
if (valijs(confirm)) {&#xD;
	arg.result = { state:&quot;ok&quot;}&#xD;
} else {&#xD;
	arg.result = { state:&quot;error&quot;, text: &quot;密码强度不符合,请重新输入&quot;};	&#xD;
}&#xD;
&#xD;
function valijs(now){&#xD;
    var re = new RegExp(&quot;[a-zA-Z]&quot;);&#xD;
    var len = re.test(now);&#xD;
	re = new RegExp(&quot;((?=[\x21-\x7e]+)[^A-Za-z0-9])&quot;);&#xD;
    len1 = re.test(now);&#xD;
    re = new RegExp(&quot;[0-9]&quot;);&#xD;
    len2 = re.test(now);&#xD;
    if(len&amp;&amp;len1&amp;&amp;len2){&#xD;
        return true;&#xD;
    }&#xD;
    else return false;&#xD;
}&#xD;
</ClientEvent>
        </Validator>
      </PropertyDef>
      <PropertyDef name="confirmNewPassword">
        <Property name="dataType">String</Property>
        <Property name="label">确认新密码</Property>
        <Property name="required">true</Property>
        <Validator type="length">
          <Property name="minLength">8</Property>
        </Validator>
      </PropertyDef>
    </DataType>
    <DataType name="dataType1">
      <PropertyDef name="dept">
        <Property name="label">所属部门</Property>
        <Property name="dataType">String</Property>
      </PropertyDef>
    </DataType>
  </Model>
  <View>
    <DataSet id="dataSetUser">
      <Property name="dataType">[dataTypeUser]</Property>
      <Property name="pageSize">20</Property>
      <Property name="dataProvider">bdf2.userMaintain#loadUsers</Property>
    </DataSet>
    <DataSet id="dataSetDeptForSelect">
      <Property name="dataType">[$dataTypeDept]</Property>
      <Property name="dataProvider">bdf2.deptSelect#loadDepts</Property>
    </DataSet>
    <DataSet id="dsAuditLog">
      <Property name="dataProvider">auditLogPR#queryAuditLog</Property>
      <Property name="dataType">[AuditLog]</Property>
      <Property name="pageSize">20</Property>
    </DataSet>
    <UpdateAction id="uaAuditLog">
      <Property name="dataResolver">auditLogPR#saveAuditLog</Property>
      <UpdateItem>
        <Property name="dataSet">dsAuditLog</Property>
      </UpdateItem>
    </UpdateAction>
    <ToolBar layoutConstraint="top">
      <DataPilot>
        <ClientEvent name="onSubControlAction">var dataSetUser = view.id(&quot;dataSetUser&quot;);&#xD;
var entityList = dataSetUser.getData();&#xD;
var userDialog=view.id(&quot;dialogUser&quot;);&#xD;
switch(arg.code){&#xD;
	case '+':&#xD;
		entityList.insert();&#xD;
		view.get(&quot;^create&quot;).set(&quot;readOnly&quot;,false);&#xD;
		view.id(&quot;afDept&quot;).get(&quot;entity&quot;).set(&quot;dept&quot;,&quot;&quot;);&#xD;
		userDialog.set(&quot;userData&quot;,&quot;insert&quot;);&#xD;
		userDialog.set(&quot;caption&quot;,&quot;添加用户信息&quot;);&#xD;
		userDialog.show();&#xD;
		arg.processDefault = false;&#xD;
		break;&#xD;
&#xD;
	case '-':&#xD;
	var user=view.id(&quot;dataSetUser&quot;).getData(&quot;#&quot;);&#xD;
	if(user==null)&#xD;
	{&#xD;
		dorado.MessageBox.alert(&quot;请首先选择用户信息!&quot;);	&#xD;
	}else{&#xD;
		dorado.MessageBox.confirm(&quot;是否确定删除此用户信息?&quot;,function(){&#xD;
				&#xD;
				var myDate = new Date();&#xD;
				view.id('dsAuditLog').getData().insert({&#xD;
					operationType:&quot;2&quot;,&#xD;
					operationPerson: &quot;${loginUsername}&quot;,&#xD;
					operationPersonName: &quot;${loginUser.getCname()}&quot;,&#xD;
					operationContent:&quot;删除所选用户&quot;,&#xD;
					operationTime:myDate&#xD;
				});&#xD;
				view.id('uaAuditLog').execute();&#xD;
				&#xD;
				user.remove();&#xD;
				view.id(&quot;updateActionUser&quot;).execute();&#xD;
		});&#xD;
	}&#xD;
	arg.processDefault = false;&#xD;
	break;&#xD;
	default:&#xD;
	//arg.processDefault = false;&#xD;
}&#xD;
</ClientEvent>
        <Property name="itemCodes">pages,+,-</Property>
        <Property name="dataSet">dataSetUser</Property>
      </DataPilot>
      <ToolBarButton>
        <ClientEvent name="onClick">var user=view.id(&quot;dataSetUser&quot;).getData(&quot;#&quot;);&#xD;
if(user)&#xD;
{&#xD;
	view.get(&quot;^create&quot;).set(&quot;readOnly&quot;,true);&#xD;
	user.set(&quot;confirmPassword&quot;, user.get(&quot;password&quot;));&#xD;
	user.setState(dorado.Entity.STATE_NONE);&#xD;
	var entity = user.get(&quot;depts&quot;).current;&#xD;
    if(entity)//显示用户部门信息&#xD;
         view.id(&quot;afDept&quot;).get(&quot;entity&quot;).set(&quot;dept&quot;,entity.get(&quot;name&quot;));&#xD;
	else&#xD;
	     view.id(&quot;afDept&quot;).get(&quot;entity&quot;).set(&quot;dept&quot;,&quot;&quot;);&#xD;
	var userDialog=view.id(&quot;dialogUser&quot;);&#xD;
	userDialog.set(&quot;userData&quot;,&quot;modify&quot;);&#xD;
	userDialog.set(&quot;caption&quot;,&quot;修改用户信息&quot;);&#xD;
	userDialog.show();&#xD;
}else{&#xD;
	dorado.MessageBox.alert(&quot;请首先选择用户信息！&quot;);&#xD;
}&#xD;
&#xD;
</ClientEvent>
        <Property name="caption">修改</Property>
        <Property name="icon"> url(>skin>common/icons.gif) -200px -0px</Property>
      </ToolBarButton>
      <ToolBarButton>
        <ClientEvent name="onClick">var user=view.id(&quot;dataSetUser&quot;).getData(&quot;#&quot;);&#xD;
if(user){&#xD;
	var username = user.get(&quot;username&quot;);&#xD;
	dorado.MessageBox.confirm(&quot;确认要重置用户&quot; +username + &quot;密码么?&quot;,function(){&#xD;
		view.id(&quot;ajaxActionResetPassword&quot;).set(&quot;parameter&quot;, username).execute(function(password){&#xD;
			dorado.MessageBox.alert(username +&quot;密码已重置,新密码为:&quot; + password);&#xD;
		});&#xD;
	});&#xD;
	var myDate = new Date();&#xD;
	view.id('dsAuditLog').getData().insert({&#xD;
		operationType:&quot;3&quot;,&#xD;
		operationPerson: &quot;${loginUsername}&quot;,&#xD;
		operationContent:&quot;重置所选用户密码&quot;,&#xD;
		operationTime:myDate&#xD;
	});&#xD;
	view.id('uaAuditLog').execute();&#xD;
}else{&#xD;
	dorado.MessageBox.alert(&quot;请首先选择用户信息！&quot;);&#xD;
}&#xD;
&#xD;
&#xD;
&#xD;
</ClientEvent>
        <Property name="caption">重置密码</Property>
        <Property name="icon"> url(>skin>common/icons.gif) -180px -180px</Property>
      </ToolBarButton>
      <ToolBarButton>
        <ClientEvent name="onClick">var dialog=view.id(&quot;$dialogPositionSelect&quot;);	&#xD;
var data=view.id(&quot;dataSetUser&quot;).getData(&quot;#&quot;);&#xD;
dialog.$show({&#xD;
	caption:&quot;选择岗位&quot;,&#xD;
	width:700,&#xD;
	callback:function(positions){&#xD;
		var ids=&quot;&quot;;&#xD;
		for(var i=0;i&lt;positions.length;i++){&#xD;
			var position=positions[i];&#xD;
			if(i==0){&#xD;
				ids=position[&quot;id&quot;];&#xD;
			}else{&#xD;
				ids+=&quot;,&quot;+position[&quot;id&quot;];						&#xD;
			}&#xD;
		}			&#xD;
		var action=view.id(&quot;ajaxActionInsertUserPosition&quot;);&#xD;
		action.set(&quot;parameter&quot;,{ids:ids,username:data.get(&quot;username&quot;)});&#xD;
		action.execute(function(error){&#xD;
			if(error){&#xD;
				for(var i=0;i&lt;positions.length;i++){&#xD;
					var position=positions[i];&#xD;
					if(position[&quot;id&quot;]==error){&#xD;
						error=position[&quot;name&quot;];&#xD;
						break;				&#xD;
					}&#xD;
				}&#xD;
				dorado.MessageBox.alert(&quot;当前选择的[&quot;+error+&quot;]已添加，请重新选择&quot;);&#xD;
			}else{&#xD;
				dialog.hide();&#xD;
				data.reset(&quot;positions&quot;);&#xD;
			}&#xD;
		});&#xD;
	}&#xD;
});&#xD;
var myDate = new Date();&#xD;
view.id('dsAuditLog').getData().insert({&#xD;
	operationType:&quot;7&quot;,&#xD;
	operationPerson: &quot;${loginUsername}&quot;,&#xD;
	operationPersonName: &quot;${loginUser.getCname()}&quot;,&#xD;
	operationContent:&quot;设置岗位&quot;,&#xD;
	operationTime:myDate&#xD;
});&#xD;
view.id('uaAuditLog').execute();</ClientEvent>
        <Property name="caption">岗位</Property>
        <Property name="icon"> url(>skin>common/icons.gif) -0px -100px</Property>
      </ToolBarButton>
      <ToolBarButton>
        <ClientEvent name="onClick">var data=view.get(&quot;#dataSetUser&quot;).getData(&quot;#&quot;);&#xD;
if(data){&#xD;
	var action=view.get(&quot;#ajaxActionInsertUserPosition&quot;);&#xD;
	action.set(&quot;parameter&quot;,{ids:'',username:data.get(&quot;username&quot;)});&#xD;
	action.execute(function(){&#xD;
		data.reset(&quot;positions&quot;);&#xD;
	});&#xD;
	var myDate = new Date();&#xD;
	view.id('dsAuditLog').getData().insert({&#xD;
		operationType:&quot;7&quot;,&#xD;
		operationPerson: &quot;${loginUsername}&quot;,&#xD;
		operationContent:&quot;清空用户岗位&quot;,&#xD;
		operationPersonName: &quot;${loginUser.getCname()}&quot;,&#xD;
		operationTime:myDate&#xD;
	});&#xD;
	view.id('uaAuditLog').execute();&#xD;
}</ClientEvent>
        <Property name="icon">url(>skin>common/icons.gif) -40px -0px</Property>
        <Property name="caption">清空岗位</Property>
      </ToolBarButton>
      <ToolBarButton>
        <ClientEvent name="onClick">var importExcelAction=view.get(&quot;#importExcelActionDemo&quot;);&#xD;
importExcelAction.set(&quot;excelModelId&quot;,&quot;0001&quot;);&#xD;
importExcelAction.execute(function(arg){&#xD;
	dorado.MessageBox.alert(&quot;成功解析导入[&quot; + arg + &quot;]数据！&quot;);&#xD;
	view.get(&quot;#dataSetUser&quot;).flushAsync();&#xD;
	var myDate = new Date();&#xD;
	view.id('dsAuditLog').getData().insert({&#xD;
		operationType:&quot;4&quot;,&#xD;
		operationPerson: &quot;${loginUsername}&quot;,&#xD;
		operationPersonName: &quot;${loginUser.getCname()}&quot;,&#xD;
		operationContent:&quot;导入用户信息&quot;,&#xD;
		operationTime:myDate&#xD;
	});&#xD;
	view.id('uaAuditLog').execute();&#xD;
});&#xD;
</ClientEvent>
        <Property name="caption">批量导入</Property>
        <Property name="icon">dorado/res/com/bstek/bdf2/importexcel/view/icons/page_excel.png</Property>
      </ToolBarButton>
      <ToolBarButton>
        <Property name="caption">导出</Property>
        <Property name="icon">url(>skin>common/icons.gif) -40px -140px</Property>
        <Property name="action">export2ReportAction1</Property>
      </ToolBarButton>
      <ToolBarButton>
        <Property name="caption">测试</Property>
        <Property name="icon">url(>skin>common/icons.gif) -40px -140px</Property>
        <Property name="action">ajaxActionR</Property>
      </ToolBarButton>
      <ToolBarButton>
        <ClientEvent name="onClick">	&#xD;
	var dsUser = view.id('dataSetUser').getData('#');&#xD;
	if(dsUser){&#xD;
		dsUser.set(&quot;confirmPassword&quot;, dsUser.get(&quot;password&quot;));&#xD;
		dsUser.set(&quot;lock&quot;,false);&#xD;
		view.id('updateActionUser').execute();&#xD;
		var myDate = new Date();&#xD;
		view.id('dsAuditLog').getData().insert({&#xD;
			operationType:&quot;6&quot;,&#xD;
			operationPerson: &quot;${loginUsername}&quot;,&#xD;
			operationContent:&quot;解锁所选用户&quot;,&#xD;
			operationPersonName: &quot;${loginUser.getCname()}&quot;,&#xD;
			operationTime:myDate&#xD;
		});&#xD;
		view.id('uaAuditLog').execute();&#xD;
	}else{&#xD;
		dorado.MessageBox.alert(&quot;请首先选择用户信息！&quot;);&#xD;
	}</ClientEvent>
        <Property name="icon">url(>skin>common/icons.gif) -60px -20px</Property>
        <Property name="caption">解锁用户</Property>
      </ToolBarButton>
    </ToolBar>
    <DataGrid id="dgUser" layoutConstraint="center">
      <Property name="dataSet">dataSetUser</Property>
      <Property name="dataType">dataTypeUser</Property>
      <Property name="readOnly">true</Property>
      <Property name="showFilterBar">false</Property>
      <Property name="filterMode">clientSide</Property>
      <Property name="stretchColumnsMode">off</Property>
      <Property name="selectionMode">none</Property>
      <Property name="showFooter">false</Property>
      <Property name="fixedColumnCount">1</Property>
      <Property name="sortMode">clientSide</Property>
      <DataColumn name="username">
        <Property name="property">username</Property>
        <Property name="width">120</Property>
      </DataColumn>
      <DataColumn>
        <Property name="property">cname</Property>
        <Property name="width">120</Property>
        <Property name="name">cname</Property>
      </DataColumn>
      <DataColumn name="male">
        <Property name="property">male</Property>
        <Property name="width">60</Property>
        <Property name="filterable">true</Property>
      </DataColumn>
      <DataColumn>
        <ClientEvent name="onRenderCell">var entitylist = arg.data.get(&quot;positions&quot;);&#xD;
var name = [];&#xD;
if (entitylist) {&#xD;
	entitylist.each(function(item){&#xD;
		name.push(item.get(&quot;name&quot;));&#xD;
	});&#xD;
}&#xD;
arg.dom.innerHTML = name.join(&quot;,&quot;);</ClientEvent>
        <Property name="name">positions</Property>
        <Property name="property">positions</Property>
        <Property name="width">120</Property>
        <Property name="filterable">true</Property>
        <Editor/>
      </DataColumn>
      <DataColumn>
        <ClientEvent name="onRenderCell">var entitylist = arg.data.get(&quot;depts&quot;);&#xD;
var name = [];&#xD;
if (entitylist) {&#xD;
	entitylist.each(function(item){&#xD;
		name.push(item.get(&quot;name&quot;));&#xD;
	});&#xD;
}&#xD;
arg.dom.innerHTML = name.join(&quot;,&quot;);</ClientEvent>
        <Property name="name">depts</Property>
        <Property name="property">depts</Property>
        <Property name="width">120</Property>
        <Property name="filterable">true</Property>
        <Editor/>
      </DataColumn>
      <DataColumn>
        <Property name="property">ip</Property>
        <Property name="filterable">true</Property>
        <Property name="width">100</Property>
        <Property name="name">ip</Property>
      </DataColumn>
      <DataColumn name="birthday">
        <Property name="property">birthday</Property>
        <Property name="filterable">true</Property>
        <Property name="width">90</Property>
      </DataColumn>
      <DataColumn name="technicalLevel">
        <Property name="property">technicalLevel</Property>
        <Property name="width">120</Property>
      </DataColumn>
      <DataColumn name="leagueMember">
        <Property name="property">leagueMember</Property>
        <Property name="width">60</Property>
      </DataColumn>
      <DataColumn name="partyMember">
        <Property name="property">partyMember</Property>
        <Property name="width">60</Property>
      </DataColumn>
      <DataColumn name="administrator">
        <Property name="property">administrator</Property>
        <Property name="width">90</Property>
        <Property name="filterable">true</Property>
      </DataColumn>
      <DataColumn name="enabled">
        <Property name="property">enabled</Property>
        <Property name="filterable">true</Property>
        <Property name="width">60</Property>
      </DataColumn>
      <DataColumn>
        <Property name="caption">密级</Property>
        <Property name="name">miji</Property>
        <Property name="property">miji</Property>
        <Editor/>
      </DataColumn>
      <DataColumn>
        <Property name="property">lock</Property>
        <Property name="name">lock</Property>
        <Editor/>
      </DataColumn>
    </DataGrid>
    <Dialog id="dialogUser">
      <ClientEvent name="onClose">view.id(&quot;dataSetUser&quot;).getData(&quot;#&quot;).cancel();&#xD;
view.id(&quot;dialogUser&quot;).setUserDept(null);</ClientEvent>
      <ClientEvent name="onReady">self.deptId = null;//定义用户部门ID&#xD;
self.setUserDept = function(deptId) {&#xD;
	self.deptId = deptId;&#xD;
}</ClientEvent>
      <Property name="center">true</Property>
      <Property name="height">460</Property>
      <Property name="width">400</Property>
      <Property name="modal">true</Property>
      <Property name="caption">用户信息</Property>
      <Buttons>
        <Button>
          <ClientEvent name="onClick">view.id(&quot;updateActionUser&quot;).execute(function(){&#xD;
	var id = view.id(&quot;dialogUser&quot;).deptId;&#xD;
    if(id){//更改部门后保存用户部门信息&#xD;
		var para = {&#xD;
			username:view.id(&quot;dataSetUser&quot;).getData(&quot;#&quot;).get(&quot;username&quot;),&#xD;
			ids:id&#xD;
		}&#xD;
	    view.id(&quot;ajaxActionInsertUserDept&quot;).set(&quot;parameter&quot;,para).execute();&#xD;
		view.id(&quot;dialogUser&quot;).setUserDept(null);&#xD;
		view.id(&quot;dataSetUser&quot;).getData(&quot;#&quot;).reset(&quot;depts&quot;);&#xD;
	}&#xD;
	view.id(&quot;dialogUser&quot;).hide();&#xD;
});&#xD;
var userDialog=view.id(&quot;dialogUser&quot;);&#xD;
var number = 0;&#xD;
if(userDialog.get(&quot;caption&quot;) == &quot;修改用户信息&quot;){&#xD;
	number = 1&#xD;
}&#xD;
var myDate = new Date();&#xD;
view.id('dsAuditLog').getData().insert({&#xD;
	operationType: number,&#xD;
	operationPerson: &quot;${loginUsername}&quot;,&#xD;
	operationPersonName: &quot;${loginUser.getCname()}&quot;,&#xD;
	operationContent: userDialog.get(&quot;caption&quot;),&#xD;
	operationTime:myDate&#xD;
});&#xD;
view.id('uaAuditLog').execute();</ClientEvent>
          <Property name="caption">保存</Property>
          <Property name="icon"> url(>skin>common/icons.gif) -140px -20px</Property>
        </Button>
        <Button>
          <ClientEvent name="onClick">dorado.MessageBox.confirm(&quot;是否确定取消此操作？&quot;,function(){&#xD;
	view.id(&quot;dataSetUser&quot;).getData(&quot;#&quot;).cancel();&#xD;
	view.id(&quot;dialogUser&quot;).setUserDept(null);&#xD;
	view.id(&quot;dialogUser&quot;).hide();&#xD;
});&#xD;
&#xD;
</ClientEvent>
          <Property name="caption">取消</Property>
          <Property name="icon"> url(>skin>common/icons.gif) -40px -0px</Property>
        </Button>
      </Buttons>
      <Children>
        <AutoForm>
          <Property name="dataSet">dataSetUser</Property>
          <Property name="dataType">dataTypeUser</Property>
          <Property name="cols">*,*</Property>
          <AutoFormElement layoutConstraint="colSpan:2">
            <Property name="name">username</Property>
            <Property name="property">username</Property>
            <Property name="tags">create</Property>
            <Editor/>
          </AutoFormElement>
          <AutoFormElement layoutConstraint="colSpan:2">
            <Property name="name">password</Property>
            <Property name="property">password</Property>
            <Property name="editorType">PasswordEditor</Property>
            <Property name="tags">create</Property>
            <Editor/>
          </AutoFormElement>
          <AutoFormElement layoutConstraint="colSpan:2">
            <Property name="name">confirmPassword</Property>
            <Property name="property">confirmPassword</Property>
            <Property name="editorType">PasswordEditor</Property>
            <Property name="tags">create</Property>
            <Editor/>
          </AutoFormElement>
          <AutoFormElement layoutConstraint="colSpan:2">
            <Property name="name">cname</Property>
            <Property name="property">cname</Property>
            <Editor/>
          </AutoFormElement>
          <AutoFormElement layoutConstraint="colSpan:2">
            <Property name="name">male</Property>
            <Property name="property">male</Property>
            <Editor/>
          </AutoFormElement>
          <AutoFormElement layoutConstraint="colSpan:2">
            <Property name="name">birthday</Property>
            <Property name="property">birthday</Property>
            <Editor/>
          </AutoFormElement>
          <AutoFormElement>
            <Property name="name">enabled</Property>
            <Property name="property">enabled</Property>
            <Editor/>
          </AutoFormElement>
          <AutoFormElement>
            <Property name="name">administrator</Property>
            <Property name="property">administrator</Property>
            <Editor/>
          </AutoFormElement>
          <AutoFormElement>
            <Property name="name">leagueMember</Property>
            <Property name="property">leagueMember</Property>
            <Editor/>
          </AutoFormElement>
          <AutoFormElement>
            <Property name="name">partyMember</Property>
            <Property name="property">partyMember</Property>
            <Editor/>
          </AutoFormElement>
          <AutoFormElement layoutConstraint="colSpan:2">
            <Property name="name">ip</Property>
            <Property name="property">ip</Property>
            <Editor/>
          </AutoFormElement>
          <AutoFormElement layoutConstraint="colSpan:2">
            <Property name="name">technicalLevel</Property>
            <Property name="property">technicalLevel</Property>
            <Property name="trigger">listDropDown1</Property>
            <Editor/>
          </AutoFormElement>
          <AutoFormElement>
            <Property name="name">miji</Property>
            <Property name="property">miji</Property>
            <Property name="label">密级</Property>
            <Editor/>
          </AutoFormElement>
        </AutoForm>
        <AutoForm id="afDept">
          <Property name="dataType">dataType1</Property>
          <Property name="createPrivateDataSet">true</Property>
          <Property name="cols">*</Property>
          <AutoFormElement>
            <Property name="label">所属部门</Property>
            <Property name="trigger">customDropDown1,triggerClear</Property>
            <Property name="property">dept</Property>
            <Property name="name">dept</Property>
            <Property name="editable">false</Property>
            <Editor/>
          </AutoFormElement>
        </AutoForm>
        <ListDropDown id="listDropDown1">
          <Property name="items">
            <Collection>
              <Entity>
                <Property name="key"></Property>
              </Entity>
              <Entity>
                <Property name="key">助理工程师</Property>
              </Entity>
              <Entity>
                <Property name="key">工程师</Property>
              </Entity>
              <Entity>
                <Property name="key">高级工程师</Property>
              </Entity>
              <Entity>
                <Property name="key">研究员</Property>
              </Entity>
            </Collection>
          </Property>
          <Property name="displayProperty">key</Property>
          <Property name="property">key</Property>
          <Property name="editable">false</Property>
        </ListDropDown>
        <CustomDropDown id="customDropDown1">
          <Property name="height">200</Property>
          <Property name="autoOpen">true</Property>
          <DataTree>
            <ClientEvent name="onDataRowClick">var dropDown = dorado.widget.DropDown.findDropDown(self);&#xD;
var node = self.get(&quot;currentNode&quot;);&#xD;
&#xD;
if (node ) {&#xD;
	dropDown.close(node.get(&quot;data.name&quot;));&#xD;
	var entity=this.id(&quot;dataSetUser&quot;).getData(&quot;#&quot;);&#xD;
	if(entity.state == 0)&#xD;
	    entity.setState(2);//修改状态，使可以提交&#xD;
	view.id(&quot;dialogUser&quot;).setUserDept(node.get(&quot;data.id&quot;));//记录选择的部门ID&#xD;
}</ClientEvent>
            <Property name="dataSet">dataSetDeptForSelect</Property>
            <BindingConfigs>
              <BindingConfig>
                <Property name="childrenProperty">children</Property>
                <Property name="expandLevel">2</Property>
                <Property name="labelProperty">name</Property>
                <Property name="recursive">true</Property>
                <Property name="icon">url(>skin>common/icons.gif) -260px -40px</Property>
              </BindingConfig>
            </BindingConfigs>
          </DataTree>
        </CustomDropDown>
      </Children>
      <Tools/>
    </Dialog>
    <UpdateAction id="updateActionUser">
      <Property name="dataResolver">bdf2.userMaintain#saveUsers</Property>
      <Property name="successMessage">数据保存成功!</Property>
      <UpdateItem>
        <Property name="dataSet">dataSetUser</Property>
      </UpdateItem>
    </UpdateAction>
    <AjaxAction id="ajaxActionResetPassword">
      <Property name="service">bdf2.userMaintain#resetPassword</Property>
    </AjaxAction>
    <AjaxAction id="ajaxActionCheckUserIsExists">
      <Property name="service">bdf2.userMaintain#userIsExists</Property>
    </AjaxAction>
    <Import id="positionSelect" src="bdf2.core.view.global.PositionSelect#$dialogPositionSelect"/>
    <AjaxAction id="ajaxActionInsertUserPosition">
      <Property name="service">bdf2.userMaintain#insertUserPosition</Property>
    </AjaxAction>
    <AjaxAction id="ajaxActionInsertUserDept">
      <Property name="service">bdf2.userMaintain#insertUserDept</Property>
    </AjaxAction>
    <ImportExcelAction id="importExcelActionDemo">
      <Property name="showImportData">true</Property>
      <Property name="bigData">true</Property>
      <Property name="startRow">2</Property>
    </ImportExcelAction>
    <Export2ReportAction id="export2ReportAction1">
      <ClientEvent name="onSuccess">var myDate = new Date();&#xD;
view.id('dsAuditLog').getData().insert({&#xD;
	operationType:&quot;5&quot;,&#xD;
	operationPerson: &quot;${loginUsername}&quot;,&#xD;
	operationPersonName: &quot;${loginUser.getCname()}&quot;,&#xD;
	operationContent:&quot;导出用户信息数据&quot;,&#xD;
	operationTime:myDate&#xD;
});&#xD;
view.id('uaAuditLog').execute();</ClientEvent>
      <Property name="template">dgUser</Property>
      <Property name="extension">xls</Property>
      <Property name="interceptorName">userReportDataInterceptor</Property>
      <Property name="dataScope">serverAll</Property>
    </Export2ReportAction>
    <AjaxAction id="ajaxActionR">
      <Property name="service">userService#checkUser</Property>
    </AjaxAction>
  </View>
</ViewConfig>
